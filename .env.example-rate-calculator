# Environment Variables for Rate Calculator

Add these variables to your `.env` file to enable the Rate Calculator:

## SharePoint Configuration

```env
# SharePoint Site ID - The unique identifier for your SharePoint site
# Get this from: https://graph.microsoft.com/v1.0/sites
SHAREPOINT_SITE_ID=your-site-id-here

# Clients List Configuration
# List Name: Clients
# Required Fields: Title (or ClientName), Email, Contact
SHAREPOINT_CLIENTS_LIST_ID=your-clients-list-id-here
SHAREPOINT_CLIENTS_LIST_NAME=Clients

# Discounts List Configuration
# List Name: Discounts
# Required Fields: Title (or DiscountName), Value (percentage)
SHAREPOINT_DISCOUNTS_LIST_ID=your-discounts-list-id-here
SHAREPOINT_DISCOUNTS_LIST_NAME=Discounts
```

## How to Find Your IDs

### Option 1: Using Microsoft Graph Explorer (Easiest)

1. Go to https://developer.microsoft.com/graph/graph-explorer
2. Sign in with your Microsoft account
3. Run queries:
   ```
   GET /sites
   ```
4. Find your site in the results and copy the `id`
5. Then query for lists:
   ```
   GET /sites/{site-id}/lists
   ```
6. Find your Clients and Discounts lists and copy their `id` values

### Option 2: Using Azure CLI

```bash
# Login to Azure
az login

# Get all sites
az graph query --query "sites?search=*yoursitename*" --resource "https://graph.microsoft.com"

# Get lists in a specific site
az graph query --query "/sites/{site-id}/lists" --resource "https://graph.microsoft.com"
```

### Option 3: Using PowerShell

```powershell
# Connect to Microsoft Graph
Connect-MgGraph -Scopes "Sites.Read.All"

# Get sites
Get-MgSite -Search "*yoursitename*"

# Get lists for a site
Get-MgSiteList -SiteId "site-id-value"
```

## Environment File Example

Complete `.env` example with Rate Calculator:

```env
# Server Configuration
PORT=5000
NODE_ENV=development
FRONTEND_URL=http://localhost:3000

# Azure AD / Microsoft Graph
AZURE_TENANT_ID=your-tenant-id
AZURE_CLIENT_ID=your-client-id
AZURE_CLIENT_SECRET=your-client-secret
GRAPH_API_ENDPOINT=https://graph.microsoft.com/v1.0

# Database
MSSQL_SERVER=your-server.database.windows.net
MSSQL_DATABASE=your-database
MSSQL_USER=your-username
MSSQL_PASSWORD=your-password

# Email Configuration
SMTP_HOST=smtp.office365.com
SMTP_PORT=587
EXCHANGE_ENDPOINT=https://outlook.office365.com/EWS/Exchange.asmx

# SharePoint Configuration (Rate Calculator)
SHAREPOINT_SITE_ID=sites/yourtenant.sharepoint.com:/sites/YourSiteName:da1b0d5a-b5f6-4a8c-9e3d-c6f4e5d9a2b1
SHAREPOINT_CLIENTS_LIST_ID=12345678-1234-1234-1234-123456789012
SHAREPOINT_CLIENTS_LIST_NAME=Clients
SHAREPOINT_DISCOUNTS_LIST_ID=87654321-4321-4321-4321-210987654321
SHAREPOINT_DISCOUNTS_LIST_NAME=Discounts

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# Logging
LOG_LEVEL=info
```

## Verifying Your Configuration

After adding the environment variables, test the connection:

```bash
# Test the clients endpoint
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  http://localhost:5000/api/rate-calculator/clients

# Test the discounts endpoint  
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  http://localhost:5000/api/rate-calculator/discounts
```

Both should return JSON arrays with your data.

## Required Microsoft Graph Permissions

Ensure your app registration in Azure AD has these permissions:
- `Sites.Read.All` - Read access to all SharePoint sites and lists

## SharePoint List Schema

### Clients List

| Column Name | Type | Required | Example |
|------------|------|----------|---------|
| Title | Single line text | ✓ | Acme Corporation |
| Email | Single line text | ✓ | contact@acme.com |
| Contact | Single line text | ✗ | John Smith |

### Discounts List

| Column Name | Type | Required | Example |
|------------|------|----------|---------|
| Title | Single line text | ✓ | Volume Discount |
| Value | Number | ✓ | 5 |

## Troubleshooting

**Getting 404 errors?**
- Verify Site ID, Client List ID, and Discount List ID are correct
- Check that lists exist in your SharePoint site
- Confirm column names match exactly

**Getting 401/403 errors?**
- Ensure access token is valid and not expired
- Check that app has `Sites.Read.All` permission
- Verify user has access to the SharePoint lists

**Getting empty arrays?**
- Verify the SharePoint lists have data
- Check that column names match the field names in rateCalculatorService.js
- Ensure proper permissions are set on the lists

**Getting Graph API errors?**
- Review error message in server logs
- Check Microsoft Graph API documentation
- Verify endpoint URL syntax
- Test query in Graph Explorer first
